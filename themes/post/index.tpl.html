{include file="header.tpl.html"}

{include file="controls/breadcrumbs.html"}

{include file="controls/pagetitle.html" pageTitle=$post->Title pageComment=$post->Comment() sideContent=$rating}

<script>var galleryItem=0; var galleryItemsCount={$galleryItems|@count}; var galleryItems = new Array(''
		{foreach from=$galleryItems item=pic}		
			,'{$pic}'
		{/foreach}
			);
			
		var page = {if $smarty.get.page=='last'}'last'{else}{$commentsPaging->CurrentPage}{/if};
</script>

		<div class='tagcategorylist'>
			<div class='padded bgwhite'>
				<div id='divPost{$post->ID}'>
								
											{$post->Text}
											
								{if $galleryItems|@count}
											<table><tr>
												<td>
													<img src="/img/prev.gif" onclick="scrollDiv('divPostImages', 100);">
												</td>
												<td>
													<div class="previewscroll nowrap">
														<div id="divPostImages" style="left:10" title="">
									{foreach from=$galleryItems item=pic name=cycle}
										<a class='hand'>
											<img class='preview' title='Щелкните для увеличения' onclick='galleryItem={$smarty.foreach.cycle.iteration}; ShowImageGallery("{$smarty.foreach.cycle.iteration}", true)' src='{$pic}' />
										</a>
											
									{/foreach}
														</div>
													</div>
												</td>
												<td title="">
													<img src="/img/next.gif" onclick="scrollDiv('divPostImages', -100);" title="" alt="">
												</td>
											</tr></table>
								{/if}
																		
							</div>
							<br />
							<br />							
					
			</div>
		</div>		
		<div>
			<div class='paddedtop'>			
				{if $currentUser->IsLogged()}
				<div class="navbar">
					<div class="navbar-inner">
						<div class="container">
			              <ul class="nav">
							{if $post->Closed}
							<li><a><Пост закрыт></a></li>
							{else}
								<li><a class='hand' onclick='$("#trCommentForPost{$post->ID}").show();'>Ответить</a></li>
				                <li><a class='hand' onmouseover='copyToQuote("{$post->User->Name}", "Post", {$post->ID})' onclick='quotePostSelection("{$post->User->Name}", "Post", {$post->ID}); return false;'>Цитата</a></li>
								{if $post->User->ID == $currentUser->ID || $currentUser->IsAdmin()}
									<li>
										<a href='/editpost/{$post->ID}'>Редактировать</a>
									</li>
								{/if}
							{/if}
			              </ul>						  
						  <ul class="nav pull-right">
							<li><a>Комментарии:</a></li>
							<li><a id='aHideComments' class='hand textunderpost' onclick='hidePostComments({$post->ID});'>скрыть</a></li>
							<li><a id='aShowComments' class='hand textunderpost hidden' onclick='showPostComments({$post->ID});'>показать</a></li>
							<li><a id='aCommentsList' class='hand textunderpost {if $currentUser->ListType=="list"}hidden{/if}' onclick='showComentsList({$post->ID});'>списком</a></li>
							<li><a id='aCommentsTree' class='hand textunderpost {if $currentUser->ListType=="tree"}hidden{/if}' onclick='showComentsTree({$post->ID});'>деревом</a></li>
							<li><a id='aSkipComments' class='hand textunderpost' onclick='goBottom();'>в конец</a></li>
						  </ul>
			            </div>
					</div>
				</div>
					
				{/if}
			</div>
			<br />
			  
			<div class='hidden padded' id='trCommentForPost{$post->ID}'>
				Ваш ответ на пост:<br />
				<textarea id='tbCommentForPost{$post->ID}' class='ck postanswer'></textarea> <br/>
				<a class='buttonsunderpost writecommentbutton hand' onclick='writeComment({$post->ID});'><b>Написать</b></a>
				<a class='buttonsunderpost hand' onclick='$("#trCommentForPost{$post->ID}").hide();'>Отмена</a>
			</div>
		</div>
		<div class='paddedtop' style='height:20px'>
			<div class='right'>
				{include file="controls/paging.html" paging=$commentsPaging}
			</div>
		</div>		
		<div class='commentlist' id='trComments{$post->ID}'>
			
		</div>
		
		{if ((!$post->Closed && $currentUser->IsLogged()) || $currentUser->IsAdmin())}
		<div id='divAnswerPostBottom' class='maincontent hidden'>
			<div>
				<a class='buttonsunderpost hand' onclick='$("#trCommentForPostBottom").show();'><b>Ответить на пост</b></a>
				<div style='float:right'>
					{include file="controls/paging.html" paging=$commentsPaging}
				</div>
			</div>		
			<br />
			<div class='hidden buttonsunderpost' id='trCommentForPostBottom'>
				Ваш ответ на пост:<br>
				<textarea class='ck postanswer' id='tbCommentForPostBottom'></textarea> <br>
				<a class='writecommentbutton hand' onclick='writeComment({$post->ID});' disabled='disabled'>Написать</a>
				<a class='hand' onclick='$(&quot;#trCommentForPostBottom&quot;).hide();'>Отмена</a>
			</div>
		</div>
		{/if}
		
		<script>
			var lastCommentID = {if $post->LastCommentID}{$post->LastCommentID}{else}-1{/if};
		
			showComments({$post->ID}, '{$currentUser->ListType}', {$commentsPaging->CurrentPage});
			{if $currentUser->ListType=='tree'}
			$("span.paging").hide();
			{/if}
			
			window.setTimeout(function() {literal}{{/literal} showNewComments({$post->ID}, lastCommentID); {literal}}{/literal}, 10000);
		</script>		

{include file="footer.tpl.html"}